<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Preview outfits and hairstyles on a virtual model">
    <title>Model Preview - Fashion Styling Platform</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Itim&family=Rufina:wght@400;700&family=Orbit&family=Jomolhari&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <link rel="stylesheet" href="../css/tailwind.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../css/main.css">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
    .outfit-layer {
        pointer-events: auto !important;
    }
    #model-preview-container {
        pointer-events: auto !important;
        touch-action: none !important;
    }
    </style>
    
    <!-- Swiper CSS (CDN) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">
    
    <!-- AOS CSS (CDN) -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
</head>
<body class="bg-white dark:bg-dark-bg text-neutral-900 dark:text-dark-text theme-transition">
    <!-- Navigation -->
    <header class="sticky top-0 z-40 bg-white/95 dark:bg-dark-surface/95 backdrop-blur border-b border-neutral-100 dark:border-dark-border shadow-sm dark:shadow-soft-dark">
        <nav class="container-custom">
            <div class="flex items-center justify-between h-16 gap-6">
                <a href="../index.html" class="flex items-center space-x-1.5 sm:space-x-2">
                    <span class="inline-flex h-7 w-7 sm:h-9 sm:w-9 items-center justify-center rounded-lg sm:rounded-xl bg-primary-600 text-white font-semibold text-xs sm:text-sm">PM</span>
                    <span class="font-rufina text-lg sm:text-xl md:text-2xl font-bold text-primary-600 dark:text-primary-400">Pyin Mal</span>
                </a>

                <div class="hidden lg:flex items-center space-x-6">
                    <a href="../index.html" class="nav-link">Home</a>
                    <div class="relative" data-dropdown="features">
                        <button class="nav-link flex items-center gap-1" data-dropdown-toggle="features-menu" aria-expanded="false">
                            Features
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                        </button>
                        <div id="features-menu" class="hidden absolute top-full left-0 mt-3 w-64 rounded-2xl border border-neutral-100 dark:border-dark-border bg-white dark:bg-dark-card shadow-soft dark:shadow-soft-dark p-4">
                            <ul class="space-y-3 text-sm text-neutral-600 dark:text-neutral-300">
                                <li><a href="haircut-recommendations.html" class="hover:text-primary-600 dark:hover:text-primary-300 flex items-center gap-2"><span>Hair Recommendations</span></a></li>
                                <li><a href="model-preview.html" class="hover:text-primary-600 dark:hover:text-primary-300 flex items-center gap-2">Model Preview</a></li>
                            </ul>
                        </div>
                    </div>
                    <a href="saved-fashion.html" class="nav-link">Favorites</a>
                    <a href="shop-browsing.html" class="nav-link">Shop</a>
                    <div class="relative" data-dropdown="more">
                        <button class="nav-link flex items-center gap-1" data-dropdown-toggle="more-menu" aria-expanded="false">
                            More
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                        </button>
                        <div id="more-menu" class="hidden absolute top-full left-0 mt-3 w-64 rounded-2xl border border-neutral-100 dark:border-dark-border bg-white dark:bg-dark-card shadow-soft dark:shadow-soft-dark p-4">
                            <div class="space-y-3 text-sm text-neutral-600 dark:text-neutral-300">
                                <a href="reviews.html" class="flex items-center gap-2 hover:text-primary-600 dark:hover:text-primary-300">Reviews</a>
                                <a href="contact.html" class="flex items-center gap-2 hover:text-primary-600 dark:hover:text-primary-300">Contact</a>
                                <a href="about.html" class="flex items-center gap-2 hover:text-primary-600 dark:hover:text-primary-300">About us</a>
                                <a href="faq.html" class="flex items-center gap-2 hover:text-primary-600 dark:hover:text-primary-300">FAQ</a>
                                <a href="pricing.html" class="flex items-center gap-2 hover:text-primary-600 dark:hover:text-primary-300">Pricing</a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex items-center space-x-2 sm:space-x-3">
                    <button id="theme-toggle" class="theme-toggle p-1.5 sm:p-2" aria-label="Toggle theme">
                        <span id="theme-icon">
                            <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/></svg>
                        </span>
                    </button>
                    <button class="theme-toggle p-1.5 sm:p-2" aria-label="Cart">
                        <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2 9m13-9l2 9m-5-4a2 2 0 11-4 0"/></svg>
                    </button>
                    <a href="login.html" class="btn btn-secondary hidden sm:inline-flex px-3 sm:px-5 py-1.5 sm:py-2 text-xs sm:text-sm">Sign In</a>
                    <a href="signup.html" class="btn btn-primary px-3 sm:px-5 py-1.5 sm:py-2 text-xs sm:text-sm">Get Started</a>
                    <button id="mobile-menu-btn" class="lg:hidden p-1.5 sm:p-2 rounded-lg hover:bg-neutral-100 dark:hover:bg-dark-card transition-colors" aria-label="Menu">
                        <svg class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
                    </button>
                </div>
            </div>

            <div id="mobile-menu" class="hidden lg:hidden pb-6 border-t border-neutral-100 dark:border-dark-border mt-3">
                <div class="pt-4 space-y-4">
                    <a href="../index.html" class="block nav-link">Home</a>
                    <div class="bg-neutral-50 dark:bg-dark-surface rounded-2xl p-4">
                        <p class="text-xs uppercase tracking-[0.4em] text-neutral-400 mb-2">Features</p>
                        <div class="flex flex-col space-y-2">
                            <a href="haircut-recommendations.html" class="nav-link">Hair Recommendations</a>
                            <a href="model-preview.html" class="nav-link">Model Preview</a>
                        </div>
                    </div>
                    <a href="saved-fashion.html" class="block nav-link">Favorites</a>
                    <a href="shop-browsing.html" class="block nav-link">Shop</a>
                    <div class="bg-neutral-50 dark:bg-dark-surface rounded-2xl p-4">
                        <p class="text-xs uppercase tracking-[0.4em] text-neutral-400 mb-2">More</p>
                        <div class="flex flex-col space-y-2">
                            <a href="reviews.html" class="nav-link">Reviews</a>
                            <a href="contact.html" class="nav-link">Contact</a>
                            <a href="about.html" class="nav-link">About us</a>
                            <a href="faq.html" class="nav-link">FAQ</a>
                            <a href="pricing.html" class="nav-link">Pricing</a>
                        </div>
                    </div>
                    <div class="flex flex-col gap-3">
                        <a href="login.html" class="btn btn-secondary w-full text-center">Sign In</a>
                        <a href="signup.html" class="btn btn-primary w-full text-center">Get Started</a>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="py-8 md:py-12">
        <div class="container-custom">
            <!-- Page Header -->
            <div class="text-center mb-8 px-2" data-aos="fade-up">
                <h1 class="font-rufina text-3xl sm:text-4xl md:text-5xl font-bold mb-4">Model Preview</h1>
                <p class="font-orbit text-base sm:text-lg text-neutral-600 dark:text-neutral-400 max-w-2xl mx-auto">
                    Try on different outfits and hairstyles on our virtual model. Mix and match to create your perfect look!
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Left Sidebar - Wardrobe (injected via JS) -->
                <div class="lg:col-span-1 space-y-6 order-2 lg:order-1" data-aos="fade-right">
                </div>

                <!-- Center - Model Preview -->
                <div class="lg:col-span-1 order-1 lg:order-2" data-aos="fade-up">
                    <div class="bg-white dark:bg-dark-card rounded-2xl p-6 shadow-soft dark:shadow-soft-dark lg:sticky top-24">
                        <div class="flex justify-center mb-4">
                            <div class="inline-flex rounded-full bg-neutral-100 dark:bg-dark-surface p-1 text-xs sm:text-sm">
                                <button id="mode-toggle-mannequin" class="px-3 py-1.5 rounded-full bg-white dark:bg-dark-card shadow-soft text-neutral-900 dark:text-dark-text">Mannequin Preview</button>
                                <button id="mode-toggle-ai" class="px-3 py-1.5 rounded-full text-neutral-600 dark:text-neutral-300">AI Real View (Demo)</button>
                            </div>
                        </div>
                        <div class="flex justify-end mb-2">
                            <div class="inline-flex rounded-full bg-neutral-100 dark:bg-dark-surface p-1 text-[10px] sm:text-xs">
                                <button id="gender-toggle-female" class="px-3 py-1.5 rounded-full bg-white dark:bg-dark-card shadow-soft text-neutral-900 dark:text-dark-text">Female</button>
                                <button id="gender-toggle-male" class="px-3 py-1.5 rounded-full text-neutral-600 dark:text-neutral-300">Male</button>
                            </div>
                        </div>
                        <h2 class="font-rufina text-2xl font-bold mb-4 text-center">Preview</h2>
                        <button id="fit-adjust-btn" class="btn btn-secondary w-full text-xs mb-6">Adjust Fit Mode</button>

                        <!-- AI Mode Instructions (shown only in AI mode) -->
                        <div id="ai-mode-instructions" class="hidden text-center text-sm text-neutral-600 dark:text-neutral-400 px-4 py-10">
                            <p>To use AI Real View, please upload your photo and select an outfit item in the panel on the right.</p>
                        </div>
                        
                        <!-- Model Preview Container -->
                        <div id="model-preview-container" class="preview-container relative overflow-auto mt-8">
                            <!-- Base Model -->
                            <img 
                                id="mannequin-base"
                                src="/public/mannequins/female-front.png" 
                                alt="Base Mannequin" 
                                class="model-base w-full h-auto"
                                onerror="this.src='/public/mannequins/female-front.png'"
                            >
                            <!-- Outfit layers will be added here dynamically -->
                            <!-- Hairstyle layers will be added here dynamically -->
                        </div>

                        <!-- Control Buttons -->
                        <div class="flex flex-col sm:flex-row lg:flex-col gap-3 mt-6">
                            <button id="reset-preview" class="btn btn-secondary w-full">
                                <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                </svg>
                                Reset
                            </button>
                            <button id="save-screenshot" class="btn btn-primary w-full">
                                <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path>
                                </svg>
                                Save Screenshot
                            </button>
                            <button id="save-to-favorites" class="btn btn-accent w-full">
                                <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                                </svg>
                                Save to Favorites
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Right Sidebar - AI Demo & Info -->
                <div class="lg:col-span-1 space-y-6 order-3" data-aos="fade-left">
                    <!-- AI Real View (Demo) Panel -->
                    <div id="ai-demo-panel" class="bg-white dark:bg-dark-card rounded-2xl p-6 shadow-soft dark:shadow-soft-dark hidden">
                        <h2 class="font-rufina text-2xl font-bold mb-4">AI Real View (Demo)</h2>
                        <div class="space-y-4 text-sm">
                            <div>
                                <p class="font-semibold mb-2">1. Upload your photo</p>
                                <input type="file" id="ai-upload-input" accept="image/*" class="block w-full text-xs">
                                <div id="ai-upload-preview" class="mt-2 text-xs text-neutral-500 dark:text-neutral-400"></div>
                            </div>
                            <div>
                                <p class="font-semibold mb-2">2. Choose an item</p>
                                <select id="ai-item-select" class="form-input text-sm w-full">
                                    <option value="">Select from your wardrobe</option>
                                </select>
                                <p class="text-xs text-neutral-500 dark:text-neutral-400 mt-1">Shows items that support mannequin try-on.</p>

                                <p class="font-semibold mt-4 mb-2 text-xs uppercase tracking-wide text-neutral-500 dark:text-neutral-400">
                                    or upload mannequin screenshot
                                </p>
                                <input type="file"
                                       id="ai-mannequin-input"
                                       accept="image/*"
                                       class="block w-full text-xs">
                                <div id="ai-mannequin-preview"
                                     class="mt-1 text-[11px] text-neutral-500 dark:text-neutral-400"></div>
                            </div>
                            <button id="ai-generate-btn" class="btn btn-primary w-full text-sm">Generate Demo Result</button>
                            <div id="ai-demo-result" class="mt-4 hidden">
                                <div class="bg-white dark:bg-dark-card rounded-2xl p-4 max-w-xs w-[90%] shadow-soft dark:shadow-soft-dark">
                                    <img id="ai-demo-image" src="" alt="AI Demo Result" class="w-full h-full object-cover">
                                </div>
                                <p class="text-xs text-neutral-500 dark:text-neutral-400 mb-3">This is a pre-generated AI demo result for illustration.</p>
                                <a id="ai-hf-link" href="https://huggingface.co/spaces/fffiloni/Virtual-Try-On" target="_blank" rel="noopener" class="btn btn-secondary w-full text-center text-xs">Open full AI try-on model</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <!-- Outfit Generator Hero & Section (embedded from outfit-generator.html) -->
    <section class="py-12 md:py-16 bg-neutral-50 dark:bg-dark-surface">
        <div class="container-custom flex flex-col gap-6 md:flex-row md:items-center md:justify-between">
            <div data-aos="fade-right">
                <p class="text-xs uppercase tracking-[0.4em] text-primary-600 dark:text-primary-400 mb-3">Outfit generator</p>
                <h2 class="font-rufina text-3xl sm:text-4xl md:text-5xl font-bold leading-tight mb-4">Pick pieces, let AI finish the look</h2>
                <p class="text-neutral-600 dark:text-neutral-400 mb-6 max-w-xl">
                    Combine tops, bottoms, shoes, and accessories. Our engine scores the pairing, suggests alternates, and sends them to your virtual wardrobe.
                </p>
                <div class="flex flex-col sm:flex-row gap-4">
                    <a href="#outfit-generator-section" class="btn btn-primary w-full sm:w-auto">Start building</a>
                    <a href="#model-preview-container" class="btn btn-secondary w-full sm:w-auto">Preview on model</a>
                </div>
            </div>
            <div class="bg-white dark:bg-dark-card rounded-3xl p-6 shadow-soft dark:shadow-soft-dark" data-aos="fade-left">
                <h3 class="font-rufina text-2xl font-semibold mb-4">Today’s prompts</h3>
                <ul class="space-y-3 text-sm text-neutral-600 dark:text-neutral-400">
                    <li>• “Hybrid office, 28°C” – minimal + breathable</li>
                    <li>• “Gallery date night” – bold prints + comfy shoes</li>
                    <li>• “Weekend getaway” – layers that pack light</li>
                </ul>
            </div>
        </div>
    </section>

    <section id="outfit-generator-section" class="py-12 md:py-16">
        <div class="container-custom grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Selection panel -->
            <div class="space-y-6 order-2 lg:order-1" data-aos="fade-right">
                <div class="bg-white dark:bg-dark-card rounded-2xl p-6 shadow-soft dark:shadow-soft-dark">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="font-rufina text-2xl font-bold">Select pieces</h2>
                        <button class="text-sm text-primary-600 dark:text-primary-400 hover:underline" onclick="outfitGenerator?.generateOutfit()">Auto pick</button>
                    </div>
                    <div class="space-y-5">
                        <!-- dynamic categories -->
                        <div>
                            <h3 class="font-semibold text-lg mb-3">Tops</h3>
                            <div class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                                <button class="outfit-item product-card p-3 text-center text-sm"
                                        data-category="top"
                                        data-item-id="top-white-shirt"
                                        data-item-name="White Shirt"
                                        data-item-image="../assets/images/outfits/top-1.png">
                                    <div class="w-full aspect-square bg-neutral-100 dark:bg-dark-surface rounded-lg mb-2">
                                        <img src="../assets/images/outfits/top-1.png"
                                            alt="White Shirt"
                                            class="w-full h-full object-cover rounded-lg">
                                    </div>
                                    White Shirt
                                </button>
                                <button class="outfit-item product-card p-3 text-center text-sm"
                                        data-category="top"
                                        data-item-id="top-knit"
                                        data-item-name="Knit Tank"
                                        data-item-image="../assets/images/outfits/top-2.png">
                                    <div class="w-full aspect-square bg-neutral-100 dark:bg-dark-surface rounded-lg mb-2">
                                        <img src="../assets/images/outfits/top-2.png"
                                            alt="Knit Tank"
                                            class="w-full h-full object-cover rounded-lg">
                                    </div>
                                    Knit Tank
                                </button>
                                <button class="outfit-item product-card p-3 text-center text-sm"
                                        data-category="top"
                                        data-item-id="top-striped-tee"
                                        data-item-name="Striped Tee"
                                        data-item-image="../assets/images/outfits/top-3.png">
                                    <div class="w-full aspect-square bg-neutral-100 dark:bg-dark-surface rounded-lg mb-2">
                                        <img src="../assets/images/outfits/top-3.png" alt="Striped Tee" class="w-full h-full object-cover rounded-lg">
                                    </div>
                                    Striped Tee
                                </button>

                                <button class="outfit-item product-card p-3 text-center text-sm"
                                        data-category="top"
                                        data-item-id="top-blouse"
                                        data-item-name="Flowy Blouse"
                                        data-item-image="../assets/images/outfits/top-4.png">
                                    <div class="w-full aspect-square bg-neutral-100 dark:bg-dark-surface rounded-lg mb-2">
                                        <img src="../assets/images/outfits/top-4.png" alt="Flowy Blouse" class="w-full h-full object-cover rounded-lg">
                                    </div>
                                    Flowy Blouse
                                </button>
                            </div>
                        </div>
                        <div>
                            <h3 class="font-semibold text-lg mb-3">Bottoms</h3>
                            <div class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                                <!-- Wide Trousers -->
                                <button class="outfit-item product-card p-3 text-center text-sm"
                                        data-category="bottom"
                                        data-item-id="bottom-wide"
                                        data-item-name="Wide Trousers"
                                        data-item-image="../assets/images/outfits/bottom-1.png">
                                    <div class="w-full aspect-square bg-neutral-100 dark:bg-dark-surface rounded-lg mb-2">
                                        <img src="../assets/images/outfits/bottom-1.png"
                                            alt="Wide Trousers"
                                            class="w-full h-full object-cover rounded-lg">
                                    </div>
                                    Wide Trousers
                                </button>

                                <!-- Relaxed Denim -->
                                <button class="outfit-item product-card p-3 text-center text-sm"
                                        data-category="bottom"
                                        data-item-id="bottom-denim"
                                        data-item-name="Relaxed Denim"
                                        data-item-image="../assets/images/outfits/bottom-2.png">
                                    <div class="w-full aspect-square bg-neutral-100 dark:bg-dark-surface rounded-lg mb-2">
                                        <img src="../assets/images/outfits/bottom-2.png"
                                            alt="Relaxed Denim"
                                            class="w-full h-full object-cover rounded-lg">
                                    </div>
                                    Relaxed Denim
                                </button>

                                <!-- Midi Skirt (if you have it) -->
                                <button class="outfit-item product-card p-3 text-center text-sm"
                                        data-category="bottom"
                                        data-item-id="bottom-midi-skirt"
                                        data-item-name="Midi Skirt"
                                        data-item-image="../assets/images/outfits/bottom-3.png">
                                    <div class="w-full aspect-square bg-neutral-100 dark:bg-dark-surface rounded-lg mb-2">
                                        <img src="../assets/images/outfits/bottom-3.png"
                                            alt="Midi Skirt"
                                            class="w-full h-full object-cover rounded-lg">
                                    </div>
                                    Midi Skirt
                                </button>

                                <!-- Tailored Pants (if you have it) -->
                                <button class="outfit-item product-card p-3 text-center text-sm"
                                        data-category="bottom"
                                        data-item-id="bottom-tailored"
                                        data-item-name="Tailored Pants"
                                        data-item-image="../assets/images/outfits/bottom-4.png">
                                    <div class="w-full aspect-square bg-neutral-100 dark:bg-dark-surface rounded-lg mb-2">
                                        <img src="../assets/images/outfits/bottom-4.png"
                                            alt="Tailored Pants"
                                            class="w-full h-full object-cover rounded-lg">
                                    </div>
                                    Tailored Pants
                                </button>
                            </div>
                        </div>
                        
                        
                        <div class="flex flex-col gap-3">
                            <button id="generate-outfit" class="btn btn-primary w-full">Generate outfit</button>
                            <button id="save-outfit" class="btn btn-secondary w-full">Save selection</button>
                        </div>
                    </div>
                </div>

                <div class="bg-white dark:bg-dark-card rounded-2xl p-6 shadow-soft dark:shadow-soft-dark">
                    <h3 class="font-rufina text-xl font-semibold mb-4">Activity history</h3>
                    <div id="activity-history" class="space-y-3 text-sm text-neutral-600 dark:text-neutral-400">
                        <p>No outfits generated yet.</p>
                    </div>
                </div>
            </div>

            <!-- Results -->
            <div class="order-3 lg:order-3 lg:col-span-1 lg:col-start-auto">
                <div class="bg-white dark:bg-dark-card rounded-2xl p-6 shadow-soft dark:shadow-soft-dark">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="font-rufina text-2xl font-bold">AI suggestions</h2>
                        <span class="text-sm text-neutral-500 dark:text-neutral-400">v0.1</span>
                    </div>
                    <div id="outfit-results" class="space-y-4">
                        <p class="text-sm text-neutral-500 dark:text-neutral-400">Generate an outfit to see curated suggestions.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- AI Demo Result Modal -->
    <div id="ai-image-modal"
         class="fixed inset-0 z-50 hidden items-center justify-center bg-black/60">
        <div class="bg-white dark:bg-dark-card rounded-2xl p-4 max-w-sm w-[90%] shadow-soft dark:shadow-soft-dark">
            <div class="rounded-xl overflow-hidden mb-3 bg-neutral-100 dark:bg-dark-surface" style="height: 260px;">
                <img id="ai-modal-image" src="" alt="AI Demo Full Result" class="w-full h-full object-cover">
            </div>
            <div class="flex gap-3 mt-2">
                <button id="ai-modal-close" class="btn btn-secondary w-full text-sm">Close</button>
                <button id="ai-modal-save" class="btn btn-primary w-full text-sm">Save image</button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-neutral-900 dark:bg-dark-bg text-white dark:text-dark-text mt-20">
        <!-- Accent Strip -->
        <div class="h-1 bg-gradient-to-r from-indigo-500 via-pink-500 to-orange-400"></div>

        <div class="container-custom py-14">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-10">
                
                <div>
                    <h3 class="font-rufina text-2xl font-bold tracking-wide mb-3">Pyin Mal</h3>
                    <p class="text-neutral-400 dark:text-neutral-500 text-sm leading-relaxed">
                        Curated style. Smarter grooming. Confidence that lasts.
                    </p>

                    <!-- Social -->
                    <div class="flex gap-4 mt-5">
                        <a href="https://www.instagram.com" target="_blank" class="hover:text-indigo-400 transition"><i class="fab fa-instagram"></i></a>
                        <a href="https://www.twitter.com" target="_blank" class="hover:text-indigo-400 transition"><i class="fab fa-twitter"></i></a>
                        <a href="https://www.linkedin.com" target="_blank" class="hover:text-indigo-400 transition"><i class="fab fa-linkedin"></i></a>
                    </div>
                </div>

                <!-- Explore -->
                <div>
                    <h4 class="font-semibold mb-4 text-indigo-400">Explore</h4>
                    <ul class="space-y-2 text-sm text-neutral-400 dark:text-neutral-500">
                        <li><a href="about.html" class="hover:text-white transition">Who We Are</a></li>
                        <li><a href="contact.html" class="hover:text-white transition">Contact</a></li>
                        <li><a href="faq.html" class="hover:text-white transition">Help Center</a></li>
                    </ul>
                </div>

                
                <div>
                    <h4 class="font-semibold mb-4 text-indigo-400">Feature</h4>
                    <ul class="space-y-2 text-sm text-neutral-400 dark:text-neutral-500">
                        <li><a href="model-preview.html" class="hover:text-white transition">Outfit preview</a></li>
                        <li><a href="haircut-recommendations.html" class="hover:text-white transition">HairStyle and Face-analysis</a></li>
                    </ul>
                </div>

                
                <div>
                    <h4 class="font-semibold mb-4 text-indigo-400">Stay Sharp</h4>
                    <p class="text-sm text-neutral-400 dark:text-neutral-500 mb-3">
                        Weekly style tips directly to your inbox.
                    </p>
                    <form class="flex">
                        <input type="email" placeholder="Your email"
                            class="w-full px-3 py-2 rounded-l bg-neutral-800 dark:bg-dark-card text-sm text-white outline-none">
                        <a href="contact.html"><button
                            class="bg-indigo-500 hover:bg-indigo-600 transition px-4 py-2 text-sm rounded-r font-semibold">
                            Join
                        </button></a>
                    </form>
                </div>

            </div>

            <!-- Bottom -->
            <div class="border-t border-neutral-800 dark:border-dark-border mt-10 pt-6 text-center text-sm text-neutral-500">
                <p> 2025 <span class="font-semibold text-white">Pyin Mal</span> — Designed for those who stand out.</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript Files -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="../js/main.js"></script>
    <script src="../js/outfit-generator.js"></script>
    <script src="../js/model-preview.js"></script>
    <script src="../js/animations.js"></script>
    <script src="../js/tryon-utils.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- Model Preview Page Specific Script -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // ========== URL MODE DETECTION ==========
            const urlParams = new URLSearchParams(window.location.search);
            const rawMode = urlParams.get('mode');
            const previewMode = (rawMode === 'ai' || rawMode === 'ai-demo') ? 'ai' : 'mannequin';
            const isHaircutMode = rawMode === 'haircut';
            const initialGender = window.getMannequinGender ? window.getMannequinGender() : 'female';
            
            // Get sidebar elements
            const outfitSidebar = document.querySelector('.outfit-selection-sidebar');
            const hairstyleSidebar = document.querySelector('.hairstyle-selection-sidebar');
            
            function applyGenderUI(gender) {
                const femaleBtn = document.getElementById('gender-toggle-female');
                const maleBtn = document.getElementById('gender-toggle-male');
                if (!femaleBtn || !maleBtn) return;

                const isMale = gender === 'male';

                if (isMale) {
                    maleBtn.classList.add('bg-white', 'dark:bg-dark-card', 'shadow-soft', 'text-neutral-900', 'dark:text-dark-text');
                    maleBtn.classList.remove('text-neutral-600', 'dark:text-neutral-300');

                    femaleBtn.classList.remove('bg-white', 'dark:bg-dark-card', 'shadow-soft', 'text-neutral-900', 'dark:text-dark-text');
                    femaleBtn.classList.add('text-neutral-600', 'dark:text-neutral-300');
                } else {
                    femaleBtn.classList.add('bg-white', 'dark:bg-dark-card', 'shadow-soft', 'text-neutral-900', 'dark:text-dark-text');
                    femaleBtn.classList.remove('text-neutral-600', 'dark:text-neutral-300');

                    maleBtn.classList.remove('bg-white', 'dark:bg-dark-card', 'shadow-soft', 'text-neutral-900', 'dark:text-dark-text');
                    maleBtn.classList.add('text-neutral-600', 'dark:text-neutral-300');
                }
            }

            // Initialize mannequin gender from storage
            if (window.setMannequinGender) {
                window.setMannequinGender(initialGender);
            } else {
                const mannequinImg = document.getElementById('mannequin-base');
                if (mannequinImg) {
                    mannequinImg.src = `/public/mannequins/${initialGender === 'male' ? 'male' : 'female'}-front.png`;
                }
            }
            applyGenderUI(initialGender);

            // ========== WARDROBE MANAGEMENT ==========
            let wardrobe = JSON.parse(localStorage.getItem('wardrobe')) || [];
            
            function renderWardrobeItems() {
                const wardrobeContainer = document.getElementById('wardrobe-items-container');
                if (!wardrobeContainer) return;
                
                if (wardrobe.length === 0) {
                    wardrobeContainer.innerHTML = `
                        <div class="text-center py-8 text-neutral-400 dark:text-neutral-500">
                            <svg class="w-12 h-12 mx-auto mb-3 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                            </svg>
                            <p class="text-sm">Your wardrobe is empty</p>
                            <a href="shop-browsing.html" class="text-primary-500 text-sm hover:underline mt-2 inline-block">Browse Fashion →</a>
                        </div>
                    `;
                    return;
                }
                
                wardrobeContainer.innerHTML = wardrobe.map(item => `
                    <div class="wardrobe-item flex items-center gap-3 p-3 bg-neutral-50 dark:bg-dark-surface rounded-xl hover:bg-neutral-100 dark:hover:bg-dark-card transition-colors" data-wardrobe-id="${item.id}">
                        <img src="${item.bgImg || item.image}" alt="${item.name}" class="w-14 h-14 object-cover rounded-lg">
                        <div class="flex-1 min-w-0">
                            <p class="font-medium text-sm truncate">${item.name}</p>
                            <p class="text-xs text-neutral-500 capitalize">${item.category}</p>
                            ${item.canTryOn
                                ? '<span class="text-[10px] mt-0.5 text-green-400">✓ Mannequin Ready</span>'
                                : '<span class="text-[10px] mt-0.5 text-red-400">✗ No Try-On Available</span>'
                            }
                        </div>
                        <div class="flex flex-col gap-1">
                            <button data-action="try-on" onclick="tryOnWardrobeItem('${item.id}')" class="text-xs px-2 py-1 bg-primary-500 text-white rounded hover:bg-primary-600 transition-colors">Try On</button>
                            <button onclick="removeFromWardrobe('${item.id}')" class="text-xs px-2 py-1 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-colors">Remove</button>
                        </div>
                    </div>
                `).join('');

                // Disable mannequin try-on for items without transparent versions
                wardrobeContainer.querySelectorAll('[data-wardrobe-id]').forEach((row) => {
                    const id = row.getAttribute('data-wardrobe-id');
                    const itemData = wardrobe.find(w => w.id === id);
                    const btn = row.querySelector('[data-action="try-on"]');
                    if (!btn || !itemData) return;
                    if (!itemData.canTryOn) {
                        btn.disabled = true;
                        btn.classList.add('opacity-50', 'cursor-not-allowed');
                    }
                });
            }
            
            window.tryOnWardrobeItem = function(itemId) {
                const item = wardrobe.find(w => w.id === itemId);
                if (!item) return;

                // Auto-switch mannequin based on item gender when available
                if (window.applyAutoGender) {
                    window.applyAutoGender(item);
                    const currentGender = window.getMannequinGender ? window.getMannequinGender() : null;
                    if (currentGender) {
                        applyGenderUI(currentGender);
                    }
                }

                if (!item.canTryOn) {
                    showNotification('This item is not ready for mannequin try-on yet.', 'warning');
                    return;
                }
                if (window.modelPreview) {
                    // Apply outfit layer based on category
                    applyOutfitLayer(item);
                    showNotification(`Trying on ${item.name}`, 'success');
                }
            };
            
            window.removeFromWardrobe = function(itemId) {
                wardrobe = wardrobe.filter(w => w.id !== itemId);
                localStorage.setItem('wardrobe', JSON.stringify(wardrobe));
                renderWardrobeItems();
                showNotification('Removed from wardrobe', 'info');
            };
            
            window.clearWardrobe = function() {
                if (confirm('Clear all items from your wardrobe?')) {
                    wardrobe = [];
                    localStorage.setItem('wardrobe', JSON.stringify(wardrobe));
                    renderWardrobeItems();
                    showNotification('Wardrobe cleared', 'info');
                }
            };
            
            // ========== OUTFIT LAYER SYSTEM & FIT ADJUST MODE ==========
            function applyOutfitLayer(item) {
                const container = document.getElementById('model-preview-container');
                if (!container) return;

                const src = item.tryOnImage || item.transparentImg || item.image;
                if (!src) return;
                
                // Remove existing layer of same category
                const existingLayer = container.querySelector(`.outfit-layer-${item.category}`);
                if (existingLayer) existingLayer.remove();
                
                // Create new layer with optional saved transform and fade-in
                const layer = document.createElement('img');
                layer.src = src;
                layer.style.pointerEvents = "auto";   // ensures dragging works
                layer.alt = item.name;
                layer.className = `outfit-layer outfit-layer-${item.category} absolute inset-0 w-full h-full object-contain opacity-0 transition-opacity duration-300`;
                layer.style.zIndex = getZIndexForCategory(item.category);
                
                if (window.applySavedTransform && item.id) {
                    window.applySavedTransform(layer, item.id);
                }

                if (window.enableLayerDragging) {
                    window.enableLayerDragging(layer, item);
                }

                if (window.fitAdjustMode) {
                    layer.classList.add('ring-2', 'ring-primary-400');
                }

                container.appendChild(layer);
                
                // Trigger fade-in
                setTimeout(() => layer.classList.remove('opacity-0'), 10);
                
                updateSelectedItemsDisplay();
            }
            
            function getZIndexForCategory(category) {
                const zIndexMap = { 'bottom': 10, 'top': 20, 'shoes': 5, 'accessories': 30 };
                return zIndexMap[category] || 15;
            }

            function updateFitAdjustLayersUI() {
                const layers = document.querySelectorAll('.outfit-layer');
                layers.forEach(layer => {
                    if (window.fitAdjustMode) {
                        layer.classList.add('ring-2', 'ring-primary-400');
                    } else {
                        layer.classList.remove('ring-2', 'ring-primary-400');
                    }
                });
            }
            
            // ========== HAIRSTYLE SYSTEM ==========
            window.applyHairstyle = function(hairstyleId, imageSrc) {
                const container = document.getElementById('model-preview-container');
                if (!container) return;
                
                // Remove existing hairstyle
                const existingHair = container.querySelector('.hairstyle-layer');
                if (existingHair) existingHair.remove();
                
                // Create new hairstyle layer
                const layer = document.createElement('img');
                layer.src = imageSrc;
                layer.alt = 'Hairstyle';
                layer.className = 'hairstyle-layer absolute inset-0 w-full h-full object-contain opacity-0 transition-opacity duration-300';
                layer.style.zIndex = 50;
                
                container.appendChild(layer);
                setTimeout(() => layer.classList.remove('opacity-0'), 10);
                
                if (window.modelPreview) {
                    window.modelPreview.currentHairstyle = hairstyleId;
                }
                updateSelectedItemsDisplay();
                showNotification('Hairstyle applied!', 'success');
            };
            
            // ========== MODE-BASED SIDEBAR SETUP ==========
            function setupModeBasedUI() {
                const leftSidebar = document.querySelector('[data-aos="fade-right"]');
                if (!leftSidebar) return;
                
                // Add wardrobe section for mannequin/AI preview (non-haircut modes)
                if (!isHaircutMode) {
                    // Insert wardrobe panel at top of sidebar
                    const wardrobePanel = document.createElement('div');
                    wardrobePanel.className = 'bg-white dark:bg-dark-card rounded-2xl p-6 shadow-soft dark:shadow-soft-dark mb-6';
                    wardrobePanel.innerHTML = `
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="font-rufina text-xl font-bold">Digital Wardrobe</h2>
                            <button onclick="clearWardrobe()" class="text-xs text-red-500 hover:underline">Clear All</button>
                        </div>
                        <div id="wardrobe-items-container" class="space-y-3 max-h-64 overflow-y-auto">
                            <!-- Wardrobe items rendered here -->
                        </div>
                        <a href="shop-browsing.html" class="btn btn-secondary w-full mt-4 text-center text-sm">+ Add from Shop</a>
                    `;
                    leftSidebar.insertBefore(wardrobePanel, leftSidebar.firstChild);
                    renderWardrobeItems();
                }
                
                // Highlight hairstyle section for haircut mode
                if (isHaircutMode) {
                    const hairstyleSection = leftSidebar.querySelector('.bg-white:last-child, .dark\\:bg-dark-card:last-child');
                    if (hairstyleSection) {
                        hairstyleSection.classList.add('ring-2', 'ring-primary-500');
                    }
                    // Scroll to hairstyle section
                    setTimeout(() => {
                        const section = document.querySelector('[data-aos="fade-right"] > div:last-child');
                        if (section) section.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }, 500);
                }
                
                // Update page title based on mode
                const pageTitle = document.querySelector('h1');
                if (pageTitle) {
                    if (isHaircutMode) {
                        pageTitle.textContent = 'Hairstyle Preview';
                    } else if (previewMode === 'ai') {
                        pageTitle.textContent = 'AI Real View (Demo)';
                    } else {
                        pageTitle.textContent = 'Model Preview';
                    }
                }
            }
            
            // Initialize mode-based UI
            setupModeBasedUI();

            // Initialize model preview if not already done
            if (!window.modelPreview) {
                window.modelPreview = new ModelPreview();
            }

            // ========== FIT ADJUST MODE TOGGLE ==========
            const fitAdjustBtn = document.getElementById('fit-adjust-btn');
            if (fitAdjustBtn) {
                // Default to ON so users can immediately drag/resize.
                if (typeof window.fitAdjustMode === 'undefined') {
                    window.fitAdjustMode = true;
                }
                // Apply initial visual state to any existing layers
                updateFitAdjustLayersUI();

                fitAdjustBtn.addEventListener('click', () => {
                    window.fitAdjustMode = !window.fitAdjustMode;
                    updateFitAdjustLayersUI();
                });
            }

            // ========== AUTO-APPLY OUTFIT FROM URL (?item=) ==========
            (async function initItemFromUrl() {
                const rawItem = urlParams.get('item');
                if (!rawItem) return;

                let decoded = null;
                try {
                    decoded = JSON.parse(decodeURIComponent(rawItem));
                } catch (err) {
                    console.warn('Failed to parse item param for model preview:', err);
                    return;
                }

                if (!decoded || !decoded.id) return;

                const normalizedItem = {
                    id: decoded.id,
                    name: decoded.name || 'Selected Outfit',
                    image: decoded.image || decoded.bgImg || '',
                    tryOnImage: decoded.tryOnImage || null,
                    transparentImg: decoded.transparentImg || null,
                    category: decoded.category || 'top',
                    gender: decoded.gender || null,
                    shop: decoded.shop || '',
                    fashionType: decoded.fashionType || ''
                };

                // If we still don't have a transparent path, try to resolve one
                // using the same filename-based logic as tryon-utils.
                if (!normalizedItem.tryOnImage && !normalizedItem.transparentImg && window.findTransparentForItem) {
                    let key = normalizedItem.id;
                    if (!key && normalizedItem.image) {
                        const file = normalizedItem.image.split('/').pop() || '';
                        key = file.replace(/\.(png|jpe?g|webp)$/i, '');
                    }
                    if (key) {
                        try {
                            const path = await window.findTransparentForItem(key);
                            if (path) {
                                normalizedItem.tryOnImage = path;
                            }
                        } catch (e) {
                            // ignore lookup errors
                        }
                    }
                }

                // Merge into wardrobe so it appears in the sidebar and
                // participates in future try-on flows.
                const existing = wardrobe.find(w => w.id === normalizedItem.id);
                if (!existing) {
                    const entry = {
                        ...normalizedItem,
                        bgImg: normalizedItem.image,
                        canTryOn: !!(normalizedItem.tryOnImage || normalizedItem.transparentImg)
                    };
                    wardrobe.push(entry);
                    localStorage.setItem('wardrobe', JSON.stringify(wardrobe));
                    renderWardrobeItems();
                }

                // Auto-apply the outfit layer to the mannequin
                applyOutfitLayer(normalizedItem);
            })();

            // Reset button
            const resetBtn = document.getElementById('reset-preview');
            if (resetBtn) {
                resetBtn.addEventListener('click', () => {
                    if (window.modelPreview) {
                        window.modelPreview.reset();
                    }
                    // Also remove all layers
                    document.querySelectorAll('.outfit-layer, .hairstyle-layer').forEach(el => el.remove());
                    updateSelectedItemsDisplay();
                    showNotification('Preview reset!', 'info');
                });
            }

            // Save screenshot button
            const saveScreenshotBtn = document.getElementById('save-screenshot');
            if (saveScreenshotBtn) {
                saveScreenshotBtn.addEventListener('click', () => {
                    if (window.html2canvas && window.modelPreview) {
                        window.modelPreview.saveScreenshot();
                    } else {
                        alert("Screenshot feature is not available — html2canvas failed to load.");
                    }
                });
            }

            // Save to favorites button
            const saveFavoritesBtn = document.getElementById('save-to-favorites');
            if (saveFavoritesBtn) {
                saveFavoritesBtn.addEventListener('click', () => {
                    saveCurrentLook();
                });
            }

            // Selected items card removed – keep function as no-op for safety
            function updateSelectedItemsDisplay() {
                return;
            }
            window.updateSelectedItemsDisplay = updateSelectedItemsDisplay;

            // Remove item function
            window.removeItem = function(category) {
                if (window.modelPreview) {
                    if (category === 'hairstyle') {
                        const hairstyleLayer = document.querySelector('.hairstyle-layer');
                        if (hairstyleLayer) {
                            hairstyleLayer.remove();
                        }
                        window.modelPreview.currentHairstyle = null;
                    } else {
                        const outfitLayer = document.querySelector(`.outfit-layer-${category}`);
                        if (outfitLayer) {
                            outfitLayer.remove();
                        }
                    }
                    updateSelectedItemsDisplay();
                }
            };

            // Save current look
            function saveCurrentLook() {
                const look = {
                    id: `look-${Date.now()}`,
                    outfit: window.modelPreview?.currentOutfit || {},
                    hairstyle: window.modelPreview?.currentHairstyle || null,
                    timestamp: new Date().toISOString()
                };

                let favorites = JSON.parse(localStorage.getItem('favoriteLooks') || '[]');
                favorites.push(look);
                localStorage.setItem('favoriteLooks', JSON.stringify(favorites));

                showNotification('Look saved to favorites!', 'success');
            }

            // Notification function
            function showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `fixed top-20 right-4 p-4 rounded-xl shadow-lg z-50 transform translate-x-full transition-transform duration-300 ${
                    type === 'success' ? 'bg-green-500' : 
                    type === 'warning' ? 'bg-yellow-500' : 
                    'bg-primary-500'
                } text-white`;
                notification.textContent = message;
                document.body.appendChild(notification);
                
                setTimeout(() => notification.classList.remove('translate-x-full'), 10);
                setTimeout(() => {
                    notification.classList.add('translate-x-full');
                    setTimeout(() => notification.remove(), 300);
                }, 2500);
            }
            window.showNotification = showNotification;

            // Listen for outfit/hairstyle changes
            const originalUpdateOutfit = window.modelPreview?.updateOutfit;
            if (window.modelPreview && originalUpdateOutfit) {
                window.modelPreview.updateOutfit = function(...args) {
                    originalUpdateOutfit.apply(this, args);
                    updateSelectedItemsDisplay();
                };
            }

            const originalUpdateHairstyle = window.modelPreview?.updateHairstyle;
            if (window.modelPreview && originalUpdateHairstyle) {
                window.modelPreview.updateHairstyle = function(...args) {
                    originalUpdateHairstyle.apply(this, args);
                    updateSelectedItemsDisplay();
                };
            }

            // ========== MODE TOGGLE & AI DEMO PANEL ==========
            const mannequinToggle = document.getElementById('mode-toggle-mannequin');
            const aiToggle = document.getElementById('mode-toggle-ai');
            const aiPanel = document.getElementById('ai-demo-panel');
            const aiUploadInput = document.getElementById('ai-upload-input');
            const aiUploadPreview = document.getElementById('ai-upload-preview');
            const aiItemSelect = document.getElementById('ai-item-select');
            const aiMannequinInput = document.getElementById('ai-mannequin-input');
            const aiMannequinPreview = document.getElementById('ai-mannequin-preview');
            const aiGenerateBtn = document.getElementById('ai-generate-btn');
            const aiDemoResult = document.getElementById('ai-demo-result');
            const aiDemoImage = document.getElementById('ai-demo-image');
            const aiImageModal = document.getElementById('ai-image-modal');
            const aiModalImage = document.getElementById('ai-modal-image');
            const aiModalClose = document.getElementById('ai-modal-close');
            const aiModalSave = document.getElementById('ai-modal-save');


            function applyPreviewModeUI(mode) {
                const isAi = mode === 'ai';
                const previewContainerEl = document.getElementById('model-preview-container');
                const aiInstructionsEl = document.getElementById('ai-mode-instructions');

                if (aiPanel) {
                    aiPanel.classList.toggle('hidden', !isAi);
                }
                if (previewContainerEl) {
                    previewContainerEl.classList.toggle('hidden', isAi);
                }
                if (aiInstructionsEl) {
                    aiInstructionsEl.classList.toggle('hidden', !isAi);
                }

                if (mannequinToggle && aiToggle) {
                    if (isAi) {
                        aiToggle.classList.add('bg-white', 'dark:bg-dark-card', 'shadow-soft');
                        mannequinToggle.classList.remove('bg-white', 'dark:bg-dark-card', 'shadow-soft');
                    } else {
                        mannequinToggle.classList.add('bg-white', 'dark:bg-dark-card', 'shadow-soft');
                        aiToggle.classList.remove('bg-white', 'dark:bg-dark-card', 'shadow-soft');
                    }
                }
            }

            applyPreviewModeUI(previewMode);

            if (mannequinToggle) {
                mannequinToggle.addEventListener('click', () => {
                    const nextUrl = new URL(window.location.href);
                    nextUrl.searchParams.set('mode', 'mannequin');
                    window.location.href = nextUrl.toString();
                });
            }

            if (aiToggle) {
                aiToggle.addEventListener('click', () => {
                    const nextUrl = new URL(window.location.href);
                    nextUrl.searchParams.set('mode', 'ai-demo');
                    window.location.href = nextUrl.toString();
                });
            }

            // ========== MANNEQUIN GENDER TOGGLE ==========
            const genderToggleFemale = document.getElementById('gender-toggle-female');
            const genderToggleMale = document.getElementById('gender-toggle-male');

            if (genderToggleFemale) {
                genderToggleFemale.addEventListener('click', () => {
                    if (window.setMannequinGender) {
                        window.setMannequinGender('female');
                    }
                    applyGenderUI('female');
                });
            }

            if (genderToggleMale) {
                genderToggleMale.addEventListener('click', () => {
                    if (window.setMannequinGender) {
                        window.setMannequinGender('male');
                    }
                    applyGenderUI('male');
                });
            }

            function refreshAiWardrobeOptions() {
                if (!aiItemSelect) return;
                const source = window.filterTryOnItems ? window.filterTryOnItems(wardrobe) : (wardrobe || []);
                aiItemSelect.innerHTML = '<option value="">Select from your wardrobe</option>' +
                    source.map(item => `<option value="${item.id}">${item.name}</option>`).join('');
            }

            // Populate AI demo item select from wardrobe
            refreshAiWardrobeOptions();

            if (aiUploadInput && aiUploadPreview) {
                aiUploadInput.addEventListener('change', () => {
                    const file = aiUploadInput.files && aiUploadInput.files[0];
                    if (!file) {
                        aiUploadPreview.textContent = '';
                        return;
                    }
                    aiUploadPreview.textContent = `Selected: ${file.name}`;
                });
            }

            if (aiGenerateBtn && aiItemSelect && aiDemoResult && aiDemoImage) {
                aiGenerateBtn.addEventListener('click', () => {
                    // Step 1: base photo is required
                    const baseFile = aiUploadInput && aiUploadInput.files && aiUploadInput.files[0];
                    if (!baseFile) {
                        showNotification('Upload a base photo first (you or your mannequin screenshot).', 'warning');
                        return;
                    }

                    // Step 2: wardrobe item OR mannequin screenshot
                    const itemId = aiItemSelect.value;
                    const mannequinShot = aiMannequinInput && aiMannequinInput.files && aiMannequinInput.files[0];

                    if (!itemId && !mannequinShot) {
                        showNotification('Choose an item from your wardrobe or upload a mannequin screenshot.', 'warning');
                        return;
                    }

                    // For the fake AI: use wardrobe item ID if present, else a generic mannequin demo
                    const demoKey = itemId || 'mannequin-default';
                    const demoPath = `/public/ai-demo-results/${encodeURIComponent(demoKey)}.png`;

                    aiDemoImage.src = demoPath;
                    aiDemoImage.alt = `AI demo try-on for ${demoKey}`;
                    aiDemoResult.classList.remove('hidden');

                    if (aiModalImage) {
                        aiModalImage.src = demoPath;
                        aiModalImage.alt = `AI demo try-on for ${demoKey}`;
                    }
                    if (aiImageModal) {
                        aiImageModal.classList.remove('hidden');
                        aiImageModal.classList.add('flex');
                    }

                    showNotification('AI demo result loaded.', 'success');
                });
            }

            if (aiModalClose && aiImageModal) {
                aiModalClose.addEventListener('click', () => {
                    aiImageModal.classList.add('hidden');
                    aiImageModal.classList.remove('flex');
                });
            }

            if (aiModalSave && aiModalImage) {
                aiModalSave.addEventListener('click', () => {
                    if (!aiModalImage.src) return;
                    const link = document.createElement('a');
                    link.href = aiModalImage.src;
                    link.download = 'ai-demo-result.png';
                    document.body.appendChild(link);
                    link.click();
                    link.remove();
                });
            }

            if (aiMannequinInput && aiMannequinPreview) {
                aiMannequinInput.addEventListener('change', () => {
                    const file = aiMannequinInput.files && aiMannequinInput.files[0];
                    aiMannequinPreview.textContent = file ? `Selected mannequin: ${file.name}` : '';
                });
            }

            // Ensure AI select stays in sync when wardrobe changes
            const originalRenderWardrobeItems = renderWardrobeItems;
            renderWardrobeItems = function() {
                originalRenderWardrobeItems();
                refreshAiWardrobeOptions();
            };

            // Initial display update
            setTimeout(updateSelectedItemsDisplay, 500);
        });
    </script>
</body>
</html>